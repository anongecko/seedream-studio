{"type":"_aim","source":"mcp-knowledge-graph"}
{"type":"entity","name":"Phase2_CoreUI","entityType":"feature","observations":["Completed Phase 2: Core UI foundation with modern animations and branding","UbuntuNerdFont integrated via @font-face (Regular, Medium, Bold, Light weights)","Brand colors: Ocean blue (#0087ff, oklch(0.55 0.18 245)) and Dream teal (#00e6b8)","Framer-motion installed and configured for all animations","Page fade-in: staggered children (0.1s delay, 0.2s start delay)","Mode tabs: smooth layoutId transition between active states using spring physics","Theme system: custom provider with localStorage persistence, animated icon transitions","Header: sticky with backdrop blur, gradient logo (ocean-500→dream-500), API key input","ModeTabs: 3 modes with hover effects, active state sliding background indicator","Layout animations: fade-up (20px) on mount, smooth mode switching (300ms)","All TypeScript strict mode compatible, build verified successful","Components location: /components/layout/header.tsx, /components/layout/theme-toggle.tsx, /components/studio/mode-tabs.tsx","Page structure: header, animated container with hero, tabs, content area, stats cards, footer","UX improvements completed: mode tab icons with gradient backgrounds when active (ocean-500→dream-500)","API key redesigned: prominent setup card at page top with format validation, eye toggle, collapsible when set","API key validation: checks length (≥20 chars), alphanumeric with dash/underscore, shows visual feedback","Loading animation: custom snake chasing tail, SVG-based, gradient colors, cycling status messages every 4s","Stats cards enhanced: gradient backgrounds per card, hover lift effect (scale 1.03, y:-2px), brand color text","Header improvements: logo wiggle on hover, sparkle rotation animation, glow effect on logo hover","Footer enhanced: animated heart pulse, operational status indicator with ping effect, keyboard shortcut hint","Theme toggle: scale animations on hover (1.05) and tap (0.95), spring physics","All components verified TypeScript strict, production build successful","Demo loading button added to preview snake animation (8s cycle)","Prompt & parameter controls completed and integrated","Stats cards now display live parameter values (quality, size, seed)","Main content area layout: prompt input, 2-column parameter grid (size | quality+seed), generate button","All components follow consistent design language: gradients, spring physics, hover effects","TypeScript strict mode passing, production build successful"]}
{"type":"entity","name":"PromptInput_Component","entityType":"component","observations":["Premium prompt textarea with dual counters (characters + words)","Gradient border animation on focus (ocean→dream)","Glow effect and background gradient when focused","600-word warning system: yellow at 500 words, red/alert at 600+","Mode-specific placeholders and example prompts","Auto-expanding textarea (120px min, 400px max)","Character count, word count, and helper text in footer","Insert example button when empty","Label animates to ocean-500 color on focus","Sparkles icon in label"]}
{"type":"entity","name":"SizeSelector_Component","entityType":"component","observations":["Visual aspect ratio selector with 3 categories: Square, Landscape, Portrait","Category tabs with layoutId animation for active background","8 total size presets with visual ratio representations","Each option shows: visual shape, ratio label, pixel dimensions","Selected state: gradient border (ocean-500), checkmark badge, glow effect","Staggered entrance animation (50ms delay per item)","Hover effects: scale 1.03, y:-2px lift","Current selection displayed in header with dimensions + ratio name","Visual shapes scale proportionally to aspect ratio inside 64px container","Helper text shows default (2048×2048) and encouragement"]}
{"type":"entity","name":"QualityToggle_Component","entityType":"component","observations":["Segmented control with 2 options: Standard (Clock icon) and Fast (Zap icon)","Active option: full gradient background (ocean→dream), white text, glow effect, scale 1.02","Shows generation time estimates: Standard ~15-20s, Fast ~8-12s","LayoutId animation for sliding background between options","Icons animate on selection: Fast option wiggles when selected","Contextual helper text changes based on selection","Spring physics for all transitions (stiffness: 500, damping: 35)"]}
{"type":"entity","name":"SeedInput_Component","entityType":"component","observations":["Number input with validation (range: -1 to 2147483647)","Three action buttons: input field, 'New' (randomize), 'Auto' (set to -1)","'New' button generates random specific seed with rotate animation","'Auto' button sets to -1 (random mode), shows gradient when active","Random mode (-1): shows dice icon overlay with 'Unique every time' text","Fixed seed mode: displays seed number in ocean-500, shows 'Fixed seed mode active' indicator","Input uses monospace font, gradient overlay when in random mode","Helper text explains seed reproduction capability","Status indicator in header shows current mode (Random/specific number)"]}
{"type":"entity","name":"GenerateButton_Component","entityType":"feature","observations":["Full-width gradient button (ocean-500→dream-500) with shine effect on hover","Shine sweeps across button (1s duration) using translateX animation","Disabled states: no prompt or no API key (50% opacity, no hover effects)","Shows rotating sparkle emoji when ready to generate","Scale animations: hover 1.02, tap 0.98 with spring physics","Helper text below button indicates what's missing (API key or prompt)","Integrated into main page with all parameter components"]}
{"type":"entity","name":"ApiPreviewPanel_Component","entityType":"component","observations":["Sliding panel from right edge, toggles with floating button","Shows real-time API request preview as formatted JSON","Uses JetBrains Mono Nerd Font for all code","Syntax highlighting: ocean-400 (keys), emerald-400 (strings), purple-400 (booleans), cyan-400 (numbers), amber-400 (arrays)","Dark gradient background: slate-950→slate-900 with ocean-500/20 border","Panel width: 320px mobile, 384px desktop (w-80 sm:w-96)","Floating toggle button: gradient (ocean→dream), shows Code2 icon + chevron","Copy to clipboard with visual feedback (Check icon for 2s)","Mobile: backdrop blur overlay, closes on tap outside","Desktop: no backdrop, panel slides over content","Header shows POST method badge + endpoint path","Helper section explains SEEDREAM_API_KEY env variable requirement","Hover effects: lines get bg-white/5, scale 1.05 on buttons","API key masked in preview (not shown), env variable placeholder used","Updates in real-time when mode/prompt/size/quality/seed changes","Location: /components/studio/api-preview-panel.tsx","Integrated into main page with all parameter props","JetBrains Mono fonts copied to public/fonts/ directory","Font-mono CSS variable updated to prioritize JetBrains Mono","Panel shows/hides via fixed toggle button on right edge","Real-time updates when any parameter changes","Production build verified successful","Seedream 4.5: Model displayed as 'seedream-4-5-251128'","Shows optimize_prompt_options structure instead of quality parameter","Always includes optimize_prompt_options in preview for user education","Maps quality prop to optimize_prompt_options.mode for API preview"]}
{"type":"entity","name":"ImageUrlInput_Component","entityType":"component","observations":["Single image URL input with real-time validation","Checks URL format and direct image link (.jpg, .jpeg, .png)","Visual validation states: idle, validating (spinner), valid (checkmark), invalid (alert)","Eye icon button opens URL in new tab for preview","Remove button for multi-image mode (when count > minImages)","Debounced validation (500ms delay)","Gradient border colors: green for valid, red for invalid, ocean on hover","Error message displays: 'URL must end with .jpg, .jpeg, or .png'","Location: /components/studio/image-url-input.tsx","Seedream 4.5: Validates 8 image formats - .jpg, .jpeg, .png, .webp, .bmp, .tiff, .tif, .gif","Max reference images updated to 14 in MultiImageInput","Error messages updated to list all supported formats","Direct link detection expanded for new formats"]}
{"type":"entity","name":"MultiImageInput_Component","entityType":"component","observations":["Manages 2-10 image URLs with add/remove functionality","Header shows current count (e.g., '2 of 10 images')","Amber warning card reminds users about direct links (.jpg, .jpeg, .png)","Add button visible when under max limit (10 images)","Each input uses ImageUrlInput component","Staggered animation (50ms delay per item)","Auto-focus on newly added inputs","Minimum 2 images enforced, cannot remove below min","Location: /components/studio/image-url-input.tsx"]}
{"type":"entity","name":"SeedreamClient_Integration","entityType":"feature","observations":["Full API integration with Supabase auto-save","Client singleton pattern via getSeedreamClient(apiKey)","Automatic metadata save to generations table (NOT images)","120s timeout for API requests","Error handling: timeout, network, API errors","Validates: prompt required, max 10 images, seed >= -1, size format","Converts size from display (×) to API (x) format","Request format: b64_json for immediate base64 display","Fixed params: stream=false, watermark=false, sequential_image_generation=disabled","Generation time tracked client-side","Location: /lib/seedream-client.ts","Seedream 4.5 integration: Model updated to 'seedream-4-5-251128'","Quality parameter internally mapped to optimize_prompt_options.mode","Size validation enforces minimum 3,686,400 total pixels (2560×1440)","Only '2K' and '4K' size presets supported (no '1K')","Max reference images validation updated to 14","Test API key generation uses '2K' size (was '1K')","Database saves quality value extracted from optimize_prompt_options.mode"]}
{"type":"entity","name":"GenerationFlow_Complete","entityType":"feature","observations":["Three UI states: input form, loading snake, result display","handleGenerate function: prepares params, calls API, handles errors","Reference images filtered by mode: none (text), single (image), multiple (multi-image)","Loading state shows animated snake with cycling messages","Result displays GenerationOutput component with metadata","'Generate Another' button resets to input form","Error messages shown in red banner below generate button","Disabled state when no prompt or no API key","All 3 modes fully functional: Text to Image, Image to Image, Multi-Image","Production build successful, TypeScript strict mode passing"]}
{"type":"entity","name":"ImageDataStorage_Feature","entityType":"feature","observations":["Database migration 002_add_image_data.sql adds image_data TEXT column","Stores base64 encoded images (~5-15MB per 4K image)","Enables future showcase/gallery page","Supabase free tier: 500MB (~50-100 images)","API client auto-saves base64 to image_data field","Index on created_at DESC for efficient gallery queries","User must run migration in Supabase SQL Editor","Migration file: /supabase/migrations/002_add_image_data.sql"]}
{"type":"entity","name":"CurlExport_Feature","entityType":"feature","observations":["Copy cURL button in GenerationOutput component","Generates complete curl command with all parameters","Uses $SEEDREAM_API_KEY environment variable placeholder","Includes: model, prompt, image URLs, size, quality, seed","Omits default values (2048x2048, standard, -1)","2-second success feedback (green highlight)","Enables easy sharing and recreation of generations","Location: /components/studio/generation-output.tsx"]}
{"type":"entity","name":"BackupWarning_Feature","entityType":"feature","observations":["Amber warning banner below image display","Text: 'Backup your work: Download image or copy cURL command'","Explains images saved but may have retention limits","Warning icon with SVG","Encourages downloading as backup","Simple, clear user guidance"]}
{"type":"entity","name":"Project Structure","entityType":"architecture","observations":["Reorganized to proper src/ directory structure per CLAUDE.md","All imports use @/* aliasing pointing to src/*","tsconfig.json: paths @/* -> ./src/*, baseUrl set to .","Created src/types/database.ts with Supabase Generation and Preset table types","Directory structure: src/{app,components/{ui,studio,layout},lib/supabase,hooks,types,constants}","Build verified successful after reorganization","Created three custom hooks in src/hooks/ per CLAUDE.md specification","use-api-key.ts: localStorage management with setApiKey, clearApiKey, hasApiKey","use-generation.ts: handles API calls, state management, returns GenerationResult with base64 images","use-presets.ts: Supabase CRUD operations - fetchPresets, createPreset, deletePreset, getPreset, getPresetsByMode","Refactored entire app to use custom hooks instead of inline state management","page.tsx now uses useApiKey and useGeneration hooks","Removed duplicate localStorage and state logic","ApiKeySetup component remains prop-based (parent-controlled pattern)","Fixed type mismatches: images param (plural), b64_json optional handling, database types nullable fields","Build verified successful after complete refactoring","Removed: URL input components (ImageUrlInput, MultiImageInput) - replaced by upload","page.tsx state: referenceImages ImageFile[] instead of referenceImageUrl/Urls strings","Generate handler: converts Files to base64 before API call","API preview: shows '[base64 image data]' placeholder for uploaded images","GenerationResult type: added referenceImageUrls field for display in output"]}
{"type":"entity","name":"BatchGeneration_Feature","entityType":"feature","observations":["Complete batch image generation support added (all 3 types)","Type 1: Text to batch (up to 15 images)","Type 2: Single image + text to batch (up to 14 images)","Type 3: Multi-image + text to batch (input refs + output ≤ 15)","UI approach: Toggle + max_images slider (not 6 tabs, kept 3 tabs clean)","BatchModeToggle component: toggle switch + slider with dynamic constraints","Constraints adjust automatically: text=15, single-ref=14, multi-ref=15-n","API client validates batch constraints before sending request","sequential_image_generation: 'auto' for batch, 'disabled' for single","sequential_image_generation_options.max_images parameter added","Response handles multiple images in data array","GenerationOutput displays grid: 1 col for single, 2 cols for 2-4, 3 cols for 5+","Each image in batch has: size badge, copy button, download button","Batch header shows total count and max_images setting","File naming: seedream-{timestamp}-{index}.png for batch downloads","Database migration 003_batch_generation_support.sql created","User must run migration in Supabase SQL Editor to update schema","Seed parameter completely removed (not supported by Seedream 4.0)","Removed from: UI, API client, types, constants, database schema, presets","Stats cards updated: replaced 'Seed' with 'Mode' (Batch/Single)","API preview panel updated to show batch params in real-time","cURL export includes batch params when enabled","Production build successful with TypeScript strict mode","Fixed slider visibility: Added proper CSS styling with styled-jsx for thumb appearance","Slider thumb: 20px gradient circle (ocean→dream), hover scale 1.1, active scale 0.95","Track gradient: Shows progress from ocean to dream color based on selected value","Added tick marks below slider: Shows all values 1-15 with labels at 1, 5, 10, 15, maxLimit","Tick marks colored: ocean-500 for selected range, muted for unselected","Math.max(1, maxLimit - 1) prevents division by zero in percentage calculation","Slider now fully functional and visually clear"]}
{"type":"entity","name":"DatabaseSchema_Changes","entityType":"schema","observations":["Migration file: supabase/migrations/003_batch_generation_support.sql","Dropped columns: seed, output_size, image_data","Added columns: batch_mode (boolean, default false), max_images (integer, nullable), output_images (JSONB)","output_images structure: [{b64_json: string | null, size: string}, ...]","Check constraint: max_images only set when batch_mode=true, range 1-15","Index added: idx_generations_batch_mode for efficient batch queries","Presets table also updated: added batch_mode and max_images columns","Types cast with 'as any' for Supabase inserts until migration runs","Database types updated in src/types/database.ts to match new schema","Migration 004: Dropped output_images column to stop storing base64 image data","Migration 005: Added images_generated INTEGER column (tracks count, not images)","Storage reduced from ~5-15MB per generation to ~1KB metadata","Table comment added: 'Stores generation metadata only. Images NOT stored.'","Check constraint: images_generated > 0","User must run both migrations 004 and 005 in Supabase SQL Editor"]}
{"type":"entity","name":"ComponentsUpdated","entityType":"architecture","observations":["NEW: src/components/studio/batch-mode-toggle.tsx - toggle + slider component","DELETED: src/components/studio/seed-input.tsx - no longer needed","UPDATED: src/components/studio/generation-output.tsx - multi-image grid display","UPDATED: src/app/page.tsx - integrated batch toggle, removed seed","UPDATED: src/components/studio/api-preview-panel.tsx - shows batch params","UPDATED: src/hooks/use-generation.ts - returns array of images","UPDATED: src/hooks/use-presets.ts - batch_mode and max_images support","UPDATED: src/lib/seedream-client.ts - full batch generation support","All components TypeScript strict mode compatible"]}
{"type":"entity","name":"SlideshowGallery_Feature","entityType":"feature","observations":["Installed embla-carousel-react (v8.6.0) for slideshow functionality","Completely redesigned GenerationOutput component for sequential viewing","Single image: Standard display with aspect ratio preservation","Batch images: Main slideshow (16:9 aspect ratio) + thumbnail grid navigation","Slideshow features: Prev/Next buttons (appear on hover), keyboard navigation, touch swipe","Thumbnail grid: 5-12 columns responsive, shows all images with #number badges","Selected thumbnail: Ocean-500 border + ring effect + scale 1.05","Click thumbnail to jump to that image in slideshow","Current image indicator: '{index + 1} / {total}' badge on slideshow","Per-image actions: Copy and Download buttons below slideshow","Navigation buttons: Circular with backdrop blur, hover scale 1.1, disabled when at edges","Embla carousel config: loop=false, align=center for smooth centered display","Tracks selected index via emblaApi.on('select') event","All transitions use smooth animations (300ms opacity)","Component maintains backward compatibility with single image mode","Database error fixed: Applied migration 005 to add images_generated column to generations table","Batch generation validated: Implementation correctly follows API spec with proper constraints (text: 15 max, 1 ref: 14 max, multi-ref: 15-n max)","Sequential_image_generation 'auto' mode: Model autonomously determines count up to max_images based on prompt - may generate fewer than max","Database saves metadata only: prompt, mode, params, images_generated count - NO image data stored","Slideshow UI complete: Responsive embla carousel, thumbnail grid (5-12 cols), prev/next nav, keyboard support, per-image actions"]}
{"type":"entity","name":"Seedream_4_5_Upgrade","entityType":"migration","observations":["Complete platform upgrade from Seedream 4.0 (seedream-4-0-250828) to Seedream 4.5 (seedream-4-5-251128)","Model ID changed: 'seedream-4-0-250828' → 'seedream-4-5-251128'","Size presets reduced: '1K', '2K', '4K' → '2K', '4K' only","Minimum total pixels increased: 921,600 (1280×720) → 3,686,400 (2560×1440)","Quality parameter replaced: 'quality: standard|fast' → 'optimize_prompt_options: { mode: standard|fast }'","Image formats expanded: jpeg, png → jpeg, jpg, png, webp, bmp, tiff, tif, gif","Max reference images clarified: 14 (not 10 as previously documented)","API endpoint remains: https://ark.ap-southeast.bytepluses.com/api/v3/images/generations","All changes backward incompatible - existing 4.0 requests will not work with 4.5 model"]}
{"type":"entity","name":"Seedream_4_5_Breaking_Changes","entityType":"documentation","observations":["BREAKING: '1K' size preset removed - use '2K' or custom dimensions ≥2560×1440","BREAKING: 'quality' parameter removed - must use 'optimize_prompt_options: { mode }' structure","BREAKING: Minimum image size increased ~4x - old small images may be rejected","NON-BREAKING: New image formats (webp, bmp, tiff, gif) add compatibility","NON-BREAKING: Max reference images now 14 (was unclear in 4.0 docs)","NON-BREAKING: Aspect ratio expanded from [1/3, 3] to [1/16, 16]","User-facing quality toggle UI remains same - backend mapping handles API change","Database quality column still stores 'standard'|'fast' string values"]}
{"type":"entity","name":"Files_Modified_4_5_Upgrade","entityType":"changelog","observations":["src/types/api.ts: SizePreset type, SeedreamRequest model & optimize_prompt_options","src/constants/parameters.ts: Size presets, min pixels, image formats, model constant","src/lib/seedream-client.ts: Model ID, quality→optimize_prompt_options mapping, validation logic","src/components/studio/image-url-input.tsx: Format validation expanded to 8 formats, max 14 images","src/components/studio/api-preview-panel.tsx: Model ID, optimize_prompt_options display","All changes TypeScript strict mode compatible","Production build successful - no compilation errors","NEW: src/components/studio/image-upload-zone.tsx - complete upload UI","MODIFIED: src/app/page.tsx - ImageFile[] state, base64 conversion on generate","MODIFIED: src/hooks/use-generation.ts - uses GenerationResult from types, saves referenceImageUrls","MODIFIED: src/types/api.ts - added referenceImageUrls to GenerationResult"]}
{"type":"entity","name":"ImageUpload_Feature","entityType":"feature","observations":["Complete replacement of URL inputs with file upload system","Drag & drop interface with file picker fallback","Client-side base64 encoding - no server storage required","Object URLs for instant preview thumbnails","Lazy base64 conversion - only on generate, not upload","Performance optimized: handles 14 images smoothly","Preview grid: 2-5 columns responsive, aspect-square thumbnails","Per-image validation badges (green checkmark/red alert)","File info: name, size (MB), validation errors","Remove button on hover overlay","Auto-cleanup: revokes object URLs on unmount and mode change","Max images: 1 for single mode, 14 for multi-image mode","Location: src/components/studio/image-upload-zone.tsx","File validation: format (8 types), size (<10MB), displays specific errors","Upload zone: dashed border, gradient background on drag, format badges","Supported formats badge row: JPG, PNG, WEBP, GIF, BMP, TIFF","Index badges (#1, #2, etc.) on each preview thumbnail","State cleared automatically when switching between modes","Base64 conversion: filesToBase64() helper function, Promise.all for parallel conversion","Type: ImageFile interface with file, preview URL, id, validation state"]}
{"type":"entity","name":"SeaDream Studio Upgrade","entityType":"project_update","observations":["Updated Next.js from 16.0.0 to 16.1.1 (CVE-2025-66478 security fix)","Updated eslint-config-next to 16.1.1","Updated baseline-browser-mapping to 2.9.12","Configured turbopack.root in next.config.ts to fix workspace root warning","All builds successful with Turbopack compiler","Dev server runs correctly on http://localhost:3000","TypeScript strict mode enabled and passing","No breaking changes from 16.0.0 to 16.1.1 - all components working"]}
{"type":"entity","name":"Video_Generation_Infrastructure","entityType":"feature","observations":["Complete video generation support added for Seedance 1.5 Pro model","API proxy routes created: POST /api/generate-video (task creation) and GET /api/generate-video/[taskId] (status polling)","Video types defined in src/types/video-api.ts with 4 modes: text-to-video, image-to-video-first, image-to-video-frames, image-to-video-ref","Video parameters in src/constants/video-parameters.ts: duration (4-12s or auto), resolution (480p/720p), ratio (7 options + adaptive), audio (on/off), service tier (default/flex)","SeedanceClient in src/lib/seedance-client.ts handles async task creation, exponential backoff polling, and Supabase save","useVideoGeneration hook manages generation state with progress tracking (queued→running→succeeded/failed)","useVideoHistory hook loads video metadata from Supabase with iteration chain support","Database migration 007 creates video_generations table with task_id, parent_task_id for iterations, stores metadata only (URLs expire in 24h)","Video UI components: VideoSizeSelector (resolution+ratio), DurationSelector (auto/fixed), AudioToggle, AdvancedOptions (service tier, return last frame)","VideoUploadZone validates images (30MB max, 300-6000px, aspect 0.4-2.5), assigns roles (first_frame, last_frame, reference_image) based on mode","VideoOutput component displays video with native controls, download buttons, 24h expiry warning, metadata cards, reference image display","Full page.tsx integration completed - seamlessly switches between image and video modes based on selected model","Type system unified - UnifiedMode type combines image and video modes, MediaType determines which UI to show","Conditional rendering - shows video components (VideoSizeSelector, DurationSelector, AudioToggle, etc.) when video model selected","Smart mode mapping - automatically transitions from text→text-to-video, image→image-to-video-first when switching models","Video state management - separate state for video parameters (duration, resolution, ratio, audio, serviceTier, returnLastFrame)","Image upload converted to base64 for video API - uses FileReader to convert uploaded images to data URIs with role assignment","Video generation flow - calls useVideoGeneration hook, displays VideoOutput component with native video player","Production build successful - TypeScript strict mode passing with type casts for video_generations table (awaiting migration)","Database migration ready - supabase/migrations/007_add_video_generations.sql ready to run in Supabase SQL Editor","All components TypeScript strict - Header, ApiKeySetup, ApiPreviewPanel, PromptInput updated to accept SeaDreamModel and UnifiedMode"]}
{"type":"relation","from":"Video_Generation_Infrastructure","to":"Seedream_4_5_Upgrade","relationType":"extends"}
{"type":"relation","from":"Video_Generation_Infrastructure","to":"Project Structure","relationType":"follows"}